.row
  .col-xs-12.col-md-offset-2.col-sm-6.col-lg-4.sp-top-sm#player
    =haml :"partials/player", locals: { admin_url: "#{url_for("/admin/album/#{album.id}")}" }
.row
  .col-xs-12.col-md-offset-2.col-sm-6.col-lg-4.sp-top-sm
    =haml :"partials/visualizer"
.row
  .col-xs-12.col-md-offset-2.col-md-7.sp-top-sm.summary#album_summary
.row
  .col-xs-12.col-md-offset-2.col-md-7.sp-top-sm.summary#track_summary

:javascript
    document.getElementById("image").style.background="url('#{url_for "/images/albums/" + (album.image || "")}')";
    document.getElementById("image").style.backgroundPosition="center";
    document.getElementById("image").style.backgroundSize="contain";
    document.getElementById("image").style.backgroundRepeat="no-repeat";
    //document.getElementById("content").style.minHeight="900px";

    var myPlaylist;

    function album_summary(data) {
      $('#album_summary').append("<div class='summary'><p class='text'>" + data.summary + "</p>");
      $('#album_summary').append("<div class='links'><a target='_' href='" + data.url + "'>wikipedia</a></div></div>");
    }

    function track_summary(data) {
      $('#track_summary').empty();
      $('#track_summary').append("<div class='summary'><p class='text'>" + data.summary + "</p>");
      $('#track_summary').append("<div class='links'><a target='_' href='" + data.url + "'>wikipedia</a></div></div>");
    }

    function get_id(str) {
      return str.substring(str.lastIndexOf('/'));
    }

    $(document).ready(function() {
      document.title = "#{album.title}";
      myPlaylist = new jPlayerPlaylist({
        jPlayer: "#jquery_jplayer_1",
        cssSelectorAncestor: "#jp_container_1"
      },
      [
        #{ album.playlist }
      ],
      {
        swfPath: "http://patf.net/js",
        supplied: "mp3",
        wmode: "window"
      });
    });

    $("#jquery_jplayer_1").bind($.jPlayer.event.play, function (event) {
        var current = myPlaylist.current,
            playlist = myPlaylist.playlist;
        $.each(playlist, function (index, obj) {
            if (index == current) {
              if(!scrubbing) {
                $.ajax({type: "GET", url: obj.mp3.replace("stream","log")});
                get_summary("#{url_for("/track")}" + get_id(obj.mp3) + '/summary', track_summary, "track_summary_available", "#track_summary");
              }
              $('.navbar-info').html("                                   \
                <a href='#{url_for("/artist/#{album.artist.id}")}' title='#{album.artist.name}'>      \
                  <span class='artist-title'>#{shorten album.artist.name, 20}</span> \
                </a>>                                                    \
                <a href='#{url_for("/album/#{album.id}")}' title='#{album.title}'>      \
                  <span class='album-title'>#{shorten album.title, 20}</span>        \
                </a>>                                                    \
                <span class='track-title'>" + obj.title + "</span>");
               $(document).prop("title", obj.title);
            }
        });
    });

    $(document).ready(function() {
      $('.navbar-info').html("                        \
        <a href='#{url_for("/artist/#{album.artist.id}")}' title='#{album.artist.name}'>      \
          <span class='artist-title'>#{shorten album.artist.name, 30}</span> \
        </a>>                                                    \
        <a href='#{url_for("/album/#{album.id}")}' title='#{album.title}'>      \
          <span class='album-title'>#{shorten album.title, 30}</span> \
        </a>");
      get_summary("#{url_for("/album/#{album.id}/summary")}", album_summary, "album_summary_available", "#album_summary");
    });


